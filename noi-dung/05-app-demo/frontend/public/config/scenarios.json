[
  {
    "id": "sp-booking-room",
    "title": "SP: ƒê·∫∑t Ph√≤ng Kh√°ch S·∫°n",
    "type": "Stored Procedure",
    "shortDesc": "T·∫°o ƒë·∫∑t ph√≤ng m·ªõi + chi ti·∫øt ph√≤ng (DATPHONG & CT_DATPHONG). Ki·ªÉm tra ph√≤ng tr·ªëng v√† th·ªùi gian h·ª£p l·ªá.",
    "sqlFile": "sp_BookingRoom.sql",
    "tables": [
      "DATPHONG",
      "CT_DATPHONG"
    ],
    "separateTables": [
      {
        "name": "DATPHONG",
        "label": "üìã B·∫£ng ƒê·∫∑t Ph√≤ng",
        "sqlBefore": "SELECT id, user_id, check_in, check_out, trang_thai FROM DATPHONG WHERE user_id = @UserId ORDER BY created_at DESC",
        "sqlAfter": "SELECT id, user_id, check_in, check_out, trang_thai FROM DATPHONG WHERE user_id = @UserId ORDER BY created_at DESC",
        "columns": [
          {
            "key": "id",
            "label": "Booking ID",
            "isPk": true
          },
          {
            "key": "user_id",
            "label": "User ID"
          },
          {
            "key": "check_in",
            "label": "Check In"
          },
          {
            "key": "check_out",
            "label": "Check Out"
          },
          {
            "key": "trang_thai",
            "label": "‚ö° Tr·∫°ng Th√°i"
          }
        ]
      },
      {
        "name": "CT_DATPHONG",
        "label": "üè® Chi Ti·∫øt ƒê·∫∑t Ph√≤ng",
        "sqlBefore": "SELECT ct.id, ct.datphong_id, ct.phong_id, p.ten_phong, ct.don_gia FROM CT_DATPHONG ct LEFT JOIN PHONG p ON p.id = ct.phong_id WHERE ct.datphong_id IN (SELECT id FROM DATPHONG WHERE user_id = @UserId)",
        "sqlAfter": "SELECT ct.id, ct.datphong_id, ct.phong_id, p.ten_phong, ct.don_gia FROM CT_DATPHONG ct LEFT JOIN PHONG p ON p.id = ct.phong_id WHERE ct.datphong_id IN (SELECT id FROM DATPHONG WHERE user_id = @UserId)",
        "columns": [
          {
            "key": "id",
            "label": "ID",
            "isPk": true
          },
          {
            "key": "datphong_id",
            "label": "Booking ID"
          },
          {
            "key": "phong_id",
            "label": "Ph√≤ng ID"
          },
          {
            "key": "ten_phong",
            "label": "T√™n Ph√≤ng"
          },
          {
            "key": "don_gia",
            "label": "‚ö° ƒê∆°n Gi√°"
          }
        ]
      }
    ],
    "sqlFetchInitial": "SELECT TOP 20 dp.id, dp.user_id, dp.check_in, dp.check_out, dp.trang_thai, ct.phong_id, ct.don_gia FROM DATPHONG dp LEFT JOIN CT_DATPHONG ct ON ct.datphong_id = dp.id ORDER BY dp.created_at DESC",
    "sqlFetchBefore": "SELECT dp.id, dp.user_id, dp.check_in, dp.check_out, dp.trang_thai, ct.phong_id, ct.don_gia FROM DATPHONG dp LEFT JOIN CT_DATPHONG ct ON ct.datphong_id = dp.id WHERE dp.user_id = @UserId ORDER BY dp.created_at DESC",
    "sqlFetchAfter": "SELECT dp.id, dp.user_id, dp.check_in, dp.check_out, dp.trang_thai, ct.phong_id, ct.don_gia FROM DATPHONG dp LEFT JOIN CT_DATPHONG ct ON ct.datphong_id = dp.id WHERE dp.user_id = @UserId ORDER BY dp.created_at DESC",
    "columns": [
      {
        "key": "id",
        "label": "Booking ID",
        "isPk": true
      },
      {
        "key": "user_id",
        "label": "User ID"
      },
      {
        "key": "phong_id",
        "label": "Ph√≤ng ID"
      },
      {
        "key": "check_in",
        "label": "Check In"
      },
      {
        "key": "check_out",
        "label": "Check Out"
      },
      {
        "key": "don_gia",
        "label": "ƒê∆°n Gi√°"
      },
      {
        "key": "trang_thai",
        "label": "Tr·∫°ng Th√°i"
      }
    ],
    "params": [
      {
        "name": "@UserId",
        "type": "int",
        "defaultValue": 1
      },
      {
        "name": "@SoPhong",
        "type": "string",
        "defaultValue": "101"
      },
      {
        "name": "@CheckIn",
        "type": "datetime",
        "defaultValue": "2026-02-01 14:00:00"
      },
      {
        "name": "@CheckOut",
        "type": "datetime",
        "defaultValue": "2026-02-05 12:00:00"
      },
      {
        "name": "@VoucherId",
        "type": "int",
        "defaultValue": null
      }
    ],
    "mockData": {
      "before": [],
      "after": [
        {
          "id": 1,
          "user_id": 1,
          "check_in": "2026-02-01T14:00:00",
          "check_out": "2026-02-05T12:00:00",
          "trang_thai": "PENDING"
        }
      ]
    }
  },
  {
    "id": "sp-apply-voucher",
    "title": "SP: √Åp D·ª•ng Voucher Gi·∫£m Gi√°",
    "type": "Stored Procedure",
    "shortDesc": "G√°n voucher v√†o booking, tƒÉng s·ªë l·∫ßn d√πng voucher, t√≠nh ti·ªÅn gi·∫£m. C√≥ th·ªÉ set voucher INACTIVE khi h·∫øt l∆∞·ª£t.",
    "sqlFile": "sp_ApplyVoucher.sql",
    "tables": [
      "VOUCHERS",
      "DATPHONG"
    ],
    "separateTables": [
      {
        "name": "DATPHONG",
        "label": "üìã B·∫£ng ƒê·∫∑t Ph√≤ng",
        "sqlBefore": "SELECT id, user_id, CAST(voucher_id as NVARCHAR(10)) as voucher_id, trang_thai FROM DATPHONG WHERE id = @DatPhongId",
        "sqlAfter": "SELECT id, user_id, CAST(voucher_id as NVARCHAR(10)) as voucher_id, trang_thai FROM DATPHONG WHERE id = @DatPhongId",
        "columns": [
          {
            "key": "id",
            "label": "ID",
            "isPk": true
          },
          {
            "key": "user_id",
            "label": "User"
          },
          {
            "key": "voucher_id",
            "label": "‚ö° Voucher G√°n"
          },
          {
            "key": "trang_thai",
            "label": "Status"
          }
        ]
      },
      {
        "name": "VOUCHERS",
        "label": "üéüÔ∏è B·∫£ng Vouchers",
        "sqlBefore": "SELECT id, ma_code, phan_tram_giam, so_lan_da_dung, so_lan_toi_da, trang_thai FROM VOUCHERS WHERE ma_code = @VoucherCode",
        "sqlAfter": "SELECT id, ma_code, phan_tram_giam, so_lan_da_dung, so_lan_toi_da, trang_thai FROM VOUCHERS WHERE ma_code = @VoucherCode",
        "columns": [
          {
            "key": "id",
            "label": "ID",
            "isPk": true
          },
          {
            "key": "ma_code",
            "label": "M√£ Code"
          },
          {
            "key": "phan_tram_giam",
            "label": "% Gi·∫£m"
          },
          {
            "key": "so_lan_da_dung",
            "label": "‚ö° ƒê√£ D√πng"
          },
          {
            "key": "so_lan_toi_da",
            "label": "T·ªëi ƒêa"
          },
          {
            "key": "trang_thai",
            "label": "Status"
          }
        ]
      }
    ],
    "sqlFetchInitial": "SELECT TOP 20 dp.id as booking_id, dp.voucher_id, dp.trang_thai as booking_status, v.id as vid, v.ma_code, v.phan_tram_giam, v.so_lan_da_dung, v.so_lan_toi_da, v.trang_thai as voucher_status FROM DATPHONG dp LEFT JOIN VOUCHERS v ON dp.voucher_id = v.id ORDER BY dp.created_at DESC",
    "sqlFetchBefore": "SELECT dp.id as booking_id, dp.user_id, CAST(dp.voucher_id as NVARCHAR(10)) as voucher_gan, v.id as voucher_id, v.ma_code, v.phan_tram_giam, v.so_lan_da_dung, v.so_lan_toi_da, v.trang_thai as voucher_status, ISNULL((SELECT SUM(don_gia) FROM CT_DATPHONG WHERE datphong_id = dp.id), 0) as tong_tien FROM DATPHONG dp CROSS JOIN VOUCHERS v WHERE dp.id = @DatPhongId AND v.ma_code = @VoucherCode",
    "sqlFetchAfter": "SELECT dp.id as booking_id, dp.user_id, CAST(dp.voucher_id as NVARCHAR(10)) as voucher_gan, v.id as voucher_id, v.ma_code, v.phan_tram_giam, v.so_lan_da_dung, v.so_lan_toi_da, v.trang_thai as voucher_status, ISNULL((SELECT SUM(don_gia) FROM CT_DATPHONG WHERE datphong_id = dp.id), 0) as tong_tien FROM DATPHONG dp LEFT JOIN VOUCHERS v ON dp.voucher_id = v.id WHERE dp.id = @DatPhongId",
    "columns": [
      {
        "key": "booking_id",
        "label": "Booking ID",
        "isPk": true
      },
      {
        "key": "user_id",
        "label": "User ID"
      },
      {
        "key": "voucher_gan",
        "label": "‚ö° Voucher ƒê√£ G√°n"
      },
      {
        "key": "tong_tien",
        "label": "T·ªïng Ti·ªÅn Ph√≤ng"
      },
      {
        "key": "voucher_id",
        "label": "Voucher ID"
      },
      {
        "key": "ma_code",
        "label": "M√£ Voucher"
      },
      {
        "key": "phan_tram_giam",
        "label": "% Gi·∫£m"
      },
      {
        "key": "so_lan_da_dung",
        "label": "‚ö° ƒê√£ D√πng"
      },
      {
        "key": "so_lan_toi_da",
        "label": "T·ªëi ƒêa"
      },
      {
        "key": "voucher_status",
        "label": "Status"
      }
    ],
    "params": [
      {
        "name": "@DatPhongId",
        "type": "int",
        "defaultValue": 4
      },
      {
        "name": "@VoucherCode",
        "type": "string",
        "defaultValue": "DISCOUNT10"
      }
    ],
    "mockData": {
      "before": [
        {
          "booking_id": 4,
          "user_id": 7,
          "voucher_gan": null,
          "tong_tien": 1500000,
          "voucher_id": 2,
          "ma_code": "DISCOUNT10",
          "phan_tram_giam": 10,
          "so_lan_da_dung": 0,
          "so_lan_toi_da": 100,
          "voucher_status": "ACTIVE"
        }
      ],
      "after": [
        {
          "booking_id": 4,
          "user_id": 7,
          "voucher_gan": "2",
          "tong_tien": 1500000,
          "voucher_id": 2,
          "ma_code": "DISCOUNT10",
          "phan_tram_giam": 10,
          "so_lan_da_dung": 1,
          "so_lan_toi_da": 100,
          "voucher_status": "ACTIVE"
        }
      ]
    }
  },
  {
    "id": "sp-cancel-room",
    "title": "SP: H·ªßy ƒê·∫∑t Ph√≤ng",
    "type": "Stored Procedure",
    "shortDesc": "Chuy·ªÉn tr·∫°ng th√°i PENDING ‚Üí CANCELLED. Ch·ªâ cho ph√©p h·ªßy khi ch∆∞a check-in.",
    "sqlFile": "sp_CancelRoom.sql",
    "tables": [
      "DATPHONG"
    ],
    "sqlFetchInitial": "SELECT TOP 20 id, user_id, check_in, check_out, trang_thai, created_at FROM DATPHONG WHERE trang_thai IN ('PENDING', 'CONFIRMED', 'CANCELLED') ORDER BY created_at DESC",
    "sqlFetchBefore": "SELECT id, user_id, check_in, check_out, trang_thai FROM DATPHONG WHERE id = @BookingId",
    "sqlFetchAfter": "SELECT id, user_id, check_in, check_out, trang_thai FROM DATPHONG WHERE id = @BookingId",
    "columns": [
      {
        "key": "id",
        "label": "Booking ID",
        "isPk": true
      },
      {
        "key": "user_id",
        "label": "User ID"
      },
      {
        "key": "check_in",
        "label": "Check In"
      },
      {
        "key": "check_out",
        "label": "Check Out"
      },
      {
        "key": "trang_thai",
        "label": "Tr·∫°ng Th√°i"
      }
    ],
    "params": [
      {
        "name": "@BookingId",
        "type": "int",
        "defaultValue": 1
      },
      {
        "name": "@UserId",
        "type": "int",
        "defaultValue": 1
      },
      {
        "name": "@LyDo",
        "type": "string",
        "defaultValue": "Thay ƒë·ªïi k·∫ø ho·∫°ch"
      }
    ],
    "mockData": {
      "before": [
        {
          "id": 1,
          "user_id": 1,
          "check_in": "2026-03-01T14:00:00",
          "check_out": "2026-03-05T12:00:00",
          "trang_thai": "PENDING"
        }
      ],
      "after": [
        {
          "id": 1,
          "user_id": 1,
          "check_in": "2026-03-01T14:00:00",
          "check_out": "2026-03-05T12:00:00",
          "trang_thai": "CANCELLED"
        }
      ]
    }
  },
  {
    "id": "sp-used-service",
    "title": "SP: S·ª≠ D·ª•ng D·ªãch V·ª•",
    "type": "Stored Procedure",
    "shortDesc": "Th√™m record v√†o CT_SUDUNG_DV khi kh√°ch s·ª≠ d·ª•ng d·ªãch v·ª•. Ch·ªâ cho ph√©p khi booking CONFIRMED.",
    "sqlFile": "sp_UsedService.sql",
    "tables": [
      "CT_SUDUNG_DV",
      "DICHVU"
    ],
    "separateTables": [
      {
        "name": "CT_SUDUNG_DV",
        "label": "üõéÔ∏è S·ª≠ D·ª•ng D·ªãch V·ª•",
        "sqlBefore": "SELECT ct.id, ct.datphong_id, ct.dichvu_id, dv.ten_dich_vu, ct.so_luong, ct.don_gia, (ct.so_luong * ct.don_gia) as thanh_tien FROM CT_SUDUNG_DV ct LEFT JOIN DICHVU dv ON dv.id = ct.dichvu_id WHERE ct.datphong_id = @DatPhongId",
        "sqlAfter": "SELECT ct.id, ct.datphong_id, ct.dichvu_id, dv.ten_dich_vu, ct.so_luong, ct.don_gia, (ct.so_luong * ct.don_gia) as thanh_tien FROM CT_SUDUNG_DV ct LEFT JOIN DICHVU dv ON dv.id = ct.dichvu_id WHERE ct.datphong_id = @DatPhongId",
        "columns": [
          {
            "key": "id",
            "label": "ID",
            "isPk": true
          },
          {
            "key": "datphong_id",
            "label": "Booking ID"
          },
          {
            "key": "dichvu_id",
            "label": "D·ªãch V·ª• ID"
          },
          {
            "key": "ten_dich_vu",
            "label": "T√™n D·ªãch V·ª•"
          },
          {
            "key": "so_luong",
            "label": "‚ö° S·ªë L∆∞·ª£ng"
          },
          {
            "key": "don_gia",
            "label": "ƒê∆°n Gi√°"
          },
          {
            "key": "thanh_tien",
            "label": "‚ö° Th√†nh Ti·ªÅn"
          }
        ]
      },
      {
        "name": "DICHVU",
        "label": "üì¶ Danh M·ª•c D·ªãch V·ª•",
        "sqlBefore": "SELECT id, ten_dich_vu, don_gia, trang_thai FROM DICHVU WHERE id = @DichVuId",
        "sqlAfter": "SELECT id, ten_dich_vu, don_gia, trang_thai FROM DICHVU WHERE id = @DichVuId",
        "columns": [
          {
            "key": "id",
            "label": "ID",
            "isPk": true
          },
          {
            "key": "ten_dich_vu",
            "label": "T√™n D·ªãch V·ª•"
          },
          {
            "key": "don_gia",
            "label": "ƒê∆°n Gi√°"
          },
          {
            "key": "trang_thai",
            "label": "Tr·∫°ng Th√°i"
          }
        ]
      }
    ],
    "sqlFetchInitial": "SELECT TOP 20 ct.id, ct.datphong_id, ct.dichvu_id, dv.ten_dich_vu, ct.so_luong, ct.don_gia, (ct.so_luong * ct.don_gia) as thanh_tien, ct.thoi_diem_su_dung FROM CT_SUDUNG_DV ct LEFT JOIN DICHVU dv ON dv.id = ct.dichvu_id ORDER BY ct.created_at DESC",
    "sqlFetchBefore": "SELECT ct.id, ct.datphong_id, ct.dichvu_id, dv.ten_dich_vu, ct.so_luong, ct.don_gia, (ct.so_luong * ct.don_gia) as thanh_tien FROM CT_SUDUNG_DV ct LEFT JOIN DICHVU dv ON dv.id = ct.dichvu_id WHERE ct.datphong_id = @DatPhongId",
    "sqlFetchAfter": "SELECT ct.id, ct.datphong_id, ct.dichvu_id, dv.ten_dich_vu, ct.so_luong, ct.don_gia, (ct.so_luong * ct.don_gia) as thanh_tien FROM CT_SUDUNG_DV ct LEFT JOIN DICHVU dv ON dv.id = ct.dichvu_id WHERE ct.datphong_id = @DatPhongId",
    "columns": [
      {
        "key": "id",
        "label": "ID",
        "isPk": true
      },
      {
        "key": "datphong_id",
        "label": "Booking ID"
      },
      {
        "key": "dichvu_id",
        "label": "D·ªãch V·ª• ID"
      },
      {
        "key": "ten_dich_vu",
        "label": "T√™n D·ªãch V·ª•"
      },
      {
        "key": "so_luong",
        "label": "S·ªë L∆∞·ª£ng"
      },
      {
        "key": "don_gia",
        "label": "ƒê∆°n Gi√°"
      },
      {
        "key": "thanh_tien",
        "label": "Th√†nh Ti·ªÅn"
      }
    ],
    "params": [
      {
        "name": "@DatPhongId",
        "type": "int",
        "defaultValue": 1
      },
      {
        "name": "@DichVuId",
        "type": "int",
        "defaultValue": 1
      },
      {
        "name": "@SoLuong",
        "type": "int",
        "defaultValue": 2
      },
      {
        "name": "@GhiChu",
        "type": "string",
        "defaultValue": "G·ªçi ph√≤ng"
      }
    ],
    "mockData": {
      "before": [],
      "after": [
        {
          "id": 1,
          "datphong_id": 1,
          "dichvu_id": 1,
          "so_luong": 2,
          "don_gia": 50000,
          "thanh_tien": 100000
        }
      ]
    }
  },
  {
    "id": "sp-create-reviews",
    "title": "SP: T·∫°o ƒê√°nh Gi√°",
    "type": "Stored Procedure",
    "shortDesc": "Th√™m review m·ªõi v√†o b·∫£ng REVIEWS. Y√™u c·∫ßu: ƒë√£ thanh to√°n, ƒë√£ check-out, ch∆∞a review tr∆∞·ªõc ƒë√≥.",
    "sqlFile": "sp_CreateReviews.sql",
    "tables": [
      "REVIEWS",
      "DATPHONG"
    ],
    "separateTables": [
      {
        "name": "REVIEWS",
        "label": "‚≠ê B·∫£ng ƒê√°nh Gi√°",
        "sqlBefore": "SELECT r.id, r.user_id, r.phong_id, r.datphong_id, r.so_sao, LEFT(r.binh_luan, 50) as binh_luan, r.trang_thai FROM REVIEWS r WHERE r.datphong_id = @DatPhongId",
        "sqlAfter": "SELECT r.id, r.user_id, r.phong_id, r.datphong_id, r.so_sao, LEFT(r.binh_luan, 50) as binh_luan, r.trang_thai FROM REVIEWS r WHERE r.datphong_id = @DatPhongId",
        "columns": [
          {
            "key": "id",
            "label": "Review ID",
            "isPk": true
          },
          {
            "key": "user_id",
            "label": "User ID"
          },
          {
            "key": "phong_id",
            "label": "Ph√≤ng ID"
          },
          {
            "key": "datphong_id",
            "label": "Booking ID"
          },
          {
            "key": "so_sao",
            "label": "‚ö° S·ªë Sao"
          },
          {
            "key": "binh_luan",
            "label": "B√¨nh Lu·∫≠n"
          },
          {
            "key": "trang_thai",
            "label": "‚ö° Tr·∫°ng Th√°i"
          }
        ]
      },
      {
        "name": "DATPHONG",
        "label": "üìã Th√¥ng Tin ƒê·∫∑t Ph√≤ng",
        "sqlBefore": "SELECT dp.id, dp.user_id, dp.phong_id, dp.trang_thai, dp.check_out FROM DATPHONG dp WHERE dp.id = @DatPhongId",
        "sqlAfter": "SELECT dp.id, dp.user_id, dp.phong_id, dp.trang_thai, dp.check_out FROM DATPHONG dp WHERE dp.id = @DatPhongId",
        "columns": [
          {
            "key": "id",
            "label": "Booking ID",
            "isPk": true
          },
          {
            "key": "user_id",
            "label": "User ID"
          },
          {
            "key": "phong_id",
            "label": "Ph√≤ng ID"
          },
          {
            "key": "check_out",
            "label": "Check Out"
          },
          {
            "key": "trang_thai",
            "label": "Tr·∫°ng Th√°i"
          }
        ]
      }
    ],
    "sqlFetchInitial": "SELECT TOP 20 r.id, r.user_id, r.phong_id, r.datphong_id, r.so_sao, r.binh_luan, r.trang_thai, r.created_at FROM REVIEWS r ORDER BY r.created_at DESC",
    "sqlFetchBefore": "SELECT r.id, r.user_id, r.phong_id, r.datphong_id, r.so_sao, LEFT(r.binh_luan, 50) as binh_luan, r.trang_thai FROM REVIEWS r WHERE r.datphong_id = @DatPhongId",
    "sqlFetchAfter": "SELECT r.id, r.user_id, r.phong_id, r.datphong_id, r.so_sao, LEFT(r.binh_luan, 50) as binh_luan, r.trang_thai FROM REVIEWS r WHERE r.datphong_id = @DatPhongId",
    "columns": [
      {
        "key": "id",
        "label": "Review ID",
        "isPk": true
      },
      {
        "key": "user_id",
        "label": "User ID"
      },
      {
        "key": "phong_id",
        "label": "Ph√≤ng ID"
      },
      {
        "key": "datphong_id",
        "label": "Booking ID"
      },
      {
        "key": "so_sao",
        "label": "S·ªë Sao"
      },
      {
        "key": "binh_luan",
        "label": "B√¨nh Lu·∫≠n"
      },
      {
        "key": "trang_thai",
        "label": "Tr·∫°ng Th√°i"
      }
    ],
    "params": [
      {
        "name": "@UserId",
        "type": "int",
        "defaultValue": 1
      },
      {
        "name": "@DatPhongId",
        "type": "int",
        "defaultValue": 1
      },
      {
        "name": "@SoSao",
        "type": "int",
        "defaultValue": 5
      },
      {
        "name": "@BinhLuan",
        "type": "string",
        "defaultValue": "Ph√≤ng r·∫•t ƒë·∫πp v√† s·∫°ch s·∫Ω!"
      }
    ],
    "mockData": {
      "before": [],
      "after": [
        {
          "id": 1,
          "user_id": 1,
          "phong_id": 1,
          "datphong_id": 1,
          "so_sao": 5,
          "binh_luan": "Ph√≤ng r·∫•t ƒë·∫πp v√† s·∫°ch s·∫Ω!",
          "trang_thai": "PENDING"
        }
      ]
    }
  },
  {
    "id": "cs-book-revenue-report",
    "title": "Cursor: B√°o C√°o Doanh Thu",
    "type": "Cursor",
    "shortDesc": "Cursor READ-ONLY: Duy·ªát qua DATPHONG, t√≠nh t·ªïng (ti·ªÅn ph√≤ng + d·ªãch v·ª•). KH√îNG thay ƒë·ªïi d·ªØ li·ªáu.",
    "sqlFile": "cs_BookRevenueReport.sql",
    "tables": [
      "DATPHONG",
      "CT_DATPHONG",
      "CT_SUDUNG_DV"
    ],
    "separateTables": [
      {
        "name": "DATPHONG",
        "label": "üìã ƒê·∫∑t Ph√≤ng",
        "sqlBefore": "SELECT dp.id, dp.user_id, u.full_name, dp.trang_thai FROM DATPHONG dp JOIN USERS u ON dp.user_id = u.id ORDER BY dp.id",
        "sqlAfter": "SELECT dp.id, dp.user_id, u.full_name, dp.trang_thai FROM DATPHONG dp JOIN USERS u ON dp.user_id = u.id ORDER BY dp.id",
        "columns": [
          {
            "key": "id",
            "label": "Booking ID",
            "isPk": true
          },
          {
            "key": "user_id",
            "label": "User ID"
          },
          {
            "key": "full_name",
            "label": "Kh√°ch H√†ng"
          },
          {
            "key": "trang_thai",
            "label": "Tr·∫°ng Th√°i"
          }
        ]
      },
      {
        "name": "CT_DATPHONG",
        "label": "üè® Ti·ªÅn Ph√≤ng",
        "sqlBefore": "SELECT ct.id, ct.datphong_id, ct.phong_id, ct.don_gia FROM CT_DATPHONG ct ORDER BY ct.datphong_id",
        "sqlAfter": "SELECT ct.id, ct.datphong_id, ct.phong_id, ct.don_gia FROM CT_DATPHONG ct ORDER BY ct.datphong_id",
        "columns": [
          {
            "key": "id",
            "label": "ID",
            "isPk": true
          },
          {
            "key": "datphong_id",
            "label": "Booking ID"
          },
          {
            "key": "phong_id",
            "label": "Ph√≤ng"
          },
          {
            "key": "don_gia",
            "label": "ƒê∆°n Gi√°"
          }
        ]
      },
      {
        "name": "CT_SUDUNG_DV",
        "label": "üõéÔ∏è Ti·ªÅn D·ªãch V·ª•",
        "sqlBefore": "SELECT dv.id, dv.datphong_id, dv.dichvu_id, dv.so_luong, dv.don_gia, (dv.so_luong * dv.don_gia) as thanh_tien FROM CT_SUDUNG_DV dv ORDER BY dv.datphong_id",
        "sqlAfter": "SELECT dv.id, dv.datphong_id, dv.dichvu_id, dv.so_luong, dv.don_gia, (dv.so_luong * dv.don_gia) as thanh_tien FROM CT_SUDUNG_DV dv ORDER BY dv.datphong_id",
        "columns": [
          {
            "key": "id",
            "label": "ID",
            "isPk": true
          },
          {
            "key": "datphong_id",
            "label": "Booking ID"
          },
          {
            "key": "dichvu_id",
            "label": "D·ªãch V·ª•"
          },
          {
            "key": "so_luong",
            "label": "SL"
          },
          {
            "key": "don_gia",
            "label": "ƒê∆°n Gi√°"
          },
          {
            "key": "thanh_tien",
            "label": "Th√†nh Ti·ªÅn"
          }
        ]
      }
    ],
    "sqlFetchInitial": "SELECT TOP 20 dp.id as booking_id, u.full_name, dp.trang_thai, ISNULL(SUM(ct.don_gia), 0) as tien_phong, ISNULL(SUM(dv.so_luong * dv.don_gia), 0) as tien_dich_vu FROM DATPHONG dp JOIN USERS u ON dp.user_id = u.id LEFT JOIN CT_DATPHONG ct ON ct.datphong_id = dp.id LEFT JOIN CT_SUDUNG_DV dv ON dv.datphong_id = dp.id GROUP BY dp.id, u.full_name, dp.trang_thai ORDER BY dp.id",
    "sqlFetchBefore": "SELECT dp.id as booking_id, u.full_name, ISNULL(SUM(ct.don_gia), 0) as tien_phong, ISNULL(SUM(dv.so_luong * dv.don_gia), 0) as tien_dich_vu, (ISNULL(SUM(ct.don_gia), 0) + ISNULL(SUM(dv.so_luong * dv.don_gia), 0)) as tong_cong FROM DATPHONG dp JOIN USERS u ON dp.user_id = u.id LEFT JOIN CT_DATPHONG ct ON ct.datphong_id = dp.id LEFT JOIN CT_SUDUNG_DV dv ON dv.datphong_id = dp.id GROUP BY dp.id, u.full_name",
    "sqlFetchAfter": "SELECT dp.id as booking_id, u.full_name, ISNULL(SUM(ct.don_gia), 0) as tien_phong, ISNULL(SUM(dv.so_luong * dv.don_gia), 0) as tien_dich_vu, (ISNULL(SUM(ct.don_gia), 0) + ISNULL(SUM(dv.so_luong * dv.don_gia), 0)) as tong_cong FROM DATPHONG dp JOIN USERS u ON dp.user_id = u.id LEFT JOIN CT_DATPHONG ct ON ct.datphong_id = dp.id LEFT JOIN CT_SUDUNG_DV dv ON dv.datphong_id = dp.id GROUP BY dp.id, u.full_name",
    "columns": [
      {
        "key": "booking_id",
        "label": "M√£ ƒê·∫∑t Ph√≤ng",
        "isPk": true
      },
      {
        "key": "full_name",
        "label": "Kh√°ch H√†ng"
      },
      {
        "key": "tien_phong",
        "label": "Ti·ªÅn Ph√≤ng"
      },
      {
        "key": "tien_dich_vu",
        "label": "Ti·ªÅn D·ªãch V·ª•"
      },
      {
        "key": "tong_cong",
        "label": "T·ªïng C·ªông"
      }
    ],
    "params": [],
    "mockData": {
      "before": [
        {
          "booking_id": 1,
          "full_name": "Nguy·ªÖn VƒÉn A",
          "tien_phong": 0,
          "tien_dich_vu": 0,
          "tong_cong": 0
        },
        {
          "booking_id": 2,
          "full_name": "Tr·∫ßn Th·ªã B",
          "tien_phong": 0,
          "tien_dich_vu": 0,
          "tong_cong": 0
        }
      ],
      "after": [
        {
          "booking_id": 1,
          "full_name": "Nguy·ªÖn VƒÉn A",
          "tien_phong": 2000000,
          "tien_dich_vu": 300000,
          "tong_cong": 2300000
        },
        {
          "booking_id": 2,
          "full_name": "Tr·∫ßn Th·ªã B",
          "tien_phong": 1500000,
          "tien_dich_vu": 150000,
          "tong_cong": 1650000
        }
      ]
    }
  },
  {
    "id": "cs-check-update-voucher",
    "title": "Cursor: Ki·ªÉm Tra & C·∫≠p Nh·∫≠t Voucher",
    "type": "Cursor",
    "shortDesc": "Cursor UPDATE: Duy·ªát VOUCHERS (ACTIVE), set INACTIVE n·∫øu so_lan_da_dung >= so_lan_toi_da. Demo b·∫£o tr√¨ d·ªØ li·ªáu.",
    "sqlFile": "cs_CheckAndUpdateManyVoucher.sql",
    "tables": [
      "VOUCHERS"
    ],
    "sqlFetchInitial": "SELECT id, ma_code, so_lan_da_dung, so_lan_toi_da, trang_thai, ngay_het_han FROM VOUCHERS ORDER BY created_at DESC",
    "sqlFetchBefore": "SELECT id, ma_code, so_lan_da_dung, so_lan_toi_da, trang_thai FROM VOUCHERS WHERE trang_thai = 'ACTIVE' OR so_lan_da_dung >= so_lan_toi_da",
    "sqlFetchAfter": "SELECT id, ma_code, so_lan_da_dung, so_lan_toi_da, trang_thai FROM VOUCHERS WHERE trang_thai = 'INACTIVE' AND so_lan_da_dung >= so_lan_toi_da OR trang_thai = 'ACTIVE'",
    "columns": [
      {
        "key": "id",
        "label": "Voucher ID",
        "isPk": true
      },
      {
        "key": "ma_code",
        "label": "M√£ Code"
      },
      {
        "key": "so_lan_da_dung",
        "label": "ƒê√£ D√πng"
      },
      {
        "key": "so_lan_toi_da",
        "label": "T·ªëi ƒêa"
      },
      {
        "key": "trang_thai",
        "label": "Tr·∫°ng Th√°i"
      }
    ],
    "params": [],
    "mockData": {
      "before": [
        {
          "id": 1,
          "ma_code": "SALE20",
          "so_lan_da_dung": 98,
          "so_lan_toi_da": 100,
          "trang_thai": "ACTIVE"
        },
        {
          "id": 2,
          "ma_code": "SALE50",
          "so_lan_da_dung": 100,
          "so_lan_toi_da": 100,
          "trang_thai": "ACTIVE"
        },
        {
          "id": 3,
          "ma_code": "FREESHIP",
          "so_lan_da_dung": 50,
          "so_lan_toi_da": 200,
          "trang_thai": "ACTIVE"
        }
      ],
      "after": [
        {
          "id": 1,
          "ma_code": "SALE20",
          "so_lan_da_dung": 98,
          "so_lan_toi_da": 100,
          "trang_thai": "ACTIVE"
        },
        {
          "id": 2,
          "ma_code": "SALE50",
          "so_lan_da_dung": 100,
          "so_lan_toi_da": 100,
          "trang_thai": "INACTIVE"
        },
        {
          "id": 3,
          "ma_code": "FREESHIP",
          "so_lan_da_dung": 50,
          "so_lan_toi_da": 200,
          "trang_thai": "ACTIVE"
        }
      ]
    }
  }
]