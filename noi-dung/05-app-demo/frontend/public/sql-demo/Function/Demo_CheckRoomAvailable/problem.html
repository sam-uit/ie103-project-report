<!DOCTYPE html>
<html lang="vi">

<head>
      <meta charset="UTF-8">
      <style>
            body {
                  font-family: 'Inter', -apple-system, sans-serif;
                  line-height: 1.7;
                  color: #1e293b;
                  background: #fff;
                  margin: 0;
                  padding: 0;
            }

            h1 {
                  font-size: 1.875rem;
                  font-weight: 700;
                  color: #059669;
                  margin: 0 0 1.5rem 0;
                  padding-bottom: 0.75rem;
                  border-bottom: 2px solid #10b981;
            }

            h2 {
                  font-size: 1.5rem;
                  font-weight: 600;
                  color: #0f172a;
                  margin: 2rem 0 1rem 0;
            }

            h3 {
                  font-size: 1.125rem;
                  font-weight: 600;
                  color: #334155;
                  margin: 1.5rem 0 0.75rem 0;
            }

            p {
                  margin: 0.75rem 0;
                  color: #475569;
            }

            ul {
                  margin: 0.75rem 0;
                  padding-left: 1.5rem;
            }

            li {
                  margin: 0.375rem 0;
                  color: #475569;
            }

            strong {
                  color: #0f172a;
                  font-weight: 600;
            }

            table {
                  width: 100%;
                  border-collapse: collapse;
                  margin: 1.25rem 0;
                  font-size: 0.9375rem;
                  background: #fff;
                  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                  border-radius: 0.5rem;
                  overflow: hidden;
            }

            th {
                  background-color: #6ee7b7;
                  padding: 0.875rem 1rem;
                  text-align: left;
                  font-weight: 600;
                  color: #064e3b;
                  border-bottom: 2px solid #34d399;
            }

            td {
                  padding: 0.75rem 1rem;
                  color: #334155;
                  border-bottom: 1px solid #e2e8f0;
            }

            tbody tr:hover {
                  background-color: #ecfdf5;
            }

            code {
                  font-family: 'Fira Code', monospace;
                  font-size: 0.875rem;
                  background-color: #ecfdf5;
                  color: #059669;
                  padding: 0.125rem 0.375rem;
                  border-radius: 0.25rem;
            }

            pre {
                  background-color: #1e293b;
                  color: #e2e8f0;
                  padding: 1.25rem;
                  border-radius: 0.5rem;
                  overflow-x: auto;
                  margin: 1.25rem 0;
            }

            pre code {
                  background: none;
                  color: inherit;
                  padding: 0;
            }

            .flow-step {
                  background-color: #ecfdf5;
                  border-left: 3px solid #10b981;
                  padding: 0.875rem 1rem;
                  margin: 0.5rem 0;
                  border-radius: 0.25rem;
                  color: #334155;
            }

            hr {
                  border: none;
                  border-top: 1px solid #e2e8f0;
                  margin: 2rem 0;
            }
      </style>
</head>

<body>
      <h1>üè® FUNCTION ‚Äì Ki·ªÉm Tra Ph√≤ng Tr·ªëng</h1>

      <h2>FN_CHECK_ROOM_AVAILABLE ‚Äì Ki·ªÉm tra ph√≤ng kh·∫£ d·ª•ng</h2>

      <div class="section">
            <h3>üìå M·ª•c ƒë√≠ch</h3>
            <p>Function ƒë·ªÉ <strong>ki·ªÉm tra ph√≤ng c√≥ th·ªÉ ƒë·∫∑t</strong> trong kho·∫£ng th·ªùi gian:</p>
            <ul>
                  <li>Ki·ªÉm tra ph√≤ng kh√¥ng b·ªã tr√πng l·ªãch</li>
                  <li>Tr·∫£ v·ªÅ TRUE/FALSE cho validation</li>
                  <li>C√≥ th·ªÉ d√πng trong CHECK constraint</li>
                  <li>S·ª≠ d·ª•ng trong WHERE clause khi t√¨m ph√≤ng</li>
            </ul>
      </div>

      <hr>

      <div class="section">
            <h3>üì• Tham s·ªë</h3>
            <table>
                  <thead>
                        <tr>
                              <th>T√™n</th>
                              <th>Ki·ªÉu</th>
                              <th>M√¥ t·∫£</th>
                        </tr>
                  </thead>
                  <tbody>
                        <tr>
                              <td><code>@RoomID</code></td>
                              <td>INT</td>
                              <td>ID ph√≤ng c·∫ßn ki·ªÉm tra</td>
                        </tr>
                        <tr>
                              <td><code>@CheckIn</code></td>
                              <td>DATETIME</td>
                              <td>Ng√†y check-in d·ª± ki·∫øn</td>
                        </tr>
                        <tr>
                              <td><code>@CheckOut</code></td>
                              <td>DATETIME</td>
                              <td>Ng√†y check-out d·ª± ki·∫øn</td>
                        </tr>
                  </tbody>
            </table>
      </div>

      <hr>

      <div class="section">
            <h3>üì§ Gi√° tr·ªã tr·∫£ v·ªÅ</h3>
            <table>
                  <thead>
                        <tr>
                              <th>Ki·ªÉu</th>
                              <th>Gi√° tr·ªã</th>
                              <th>√ù nghƒ©a</th>
                        </tr>
                  </thead>
                  <tbody>
                        <tr>
                              <td>BIT</td>
                              <td>1</td>
                              <td>Ph√≤ng c√≥ th·ªÉ ƒë·∫∑t</td>
                        </tr>
                        <tr>
                              <td>BIT</td>
                              <td>0</td>
                              <td>Ph√≤ng ƒë√£ c√≥ ng∆∞·ªùi ƒë·∫∑t</td>
                        </tr>
                  </tbody>
            </table>
      </div>

      <hr>

      <div class="section">
            <h3>üîÑ Logic x·ª≠ l√Ω</h3>
            <div class="flow-step">1. Query b·∫£ng <code>CT_DATPHONG</code> v·ªõi phong_id</div>
            <div class="flow-step">2. JOIN v·ªõi <code>DATPHONG</code> ƒë·ªÉ l·∫•y th·ªùi gian</div>
            <div class="flow-step">3. Ki·ªÉm tra overlap: (NewCheckIn &lt; ExistingCheckOut) AND (NewCheckOut &gt;
                  ExistingCheckIn)</div>
            <div class="flow-step">4. N·∫øu c√≥ conflict ‚Üí return 0, ng∆∞·ª£c l·∫°i ‚Üí return 1</div>
      </div>

      <hr>

      <div class="section">
            <h3>‚úÖ C√°ch s·ª≠ d·ª•ng</h3>
            <pre><code>-- Ki·ªÉm tra 1 ph√≤ng c·ª• th·ªÉ
SELECT dbo.FN_CHECK_ROOM_AVAILABLE(101, '2024-02-20', '2024-02-25');
-- K·∫øt qu·∫£: 1 (c√≥ th·ªÉ ƒë·∫∑t) ho·∫∑c 0 (ƒë√£ c√≥ ng∆∞·ªùi)

-- T√¨m t·∫•t c·∫£ ph√≤ng tr·ªëng trong kho·∫£ng th·ªùi gian
SELECT * FROM PHONG p
WHERE dbo.FN_CHECK_ROOM_AVAILABLE(p.id, '2024-02-20', '2024-02-25') = 1;

-- S·ª≠ d·ª•ng trong validation
IF dbo.FN_CHECK_ROOM_AVAILABLE(@RoomID, @CheckIn, @CheckOut) = 0
BEGIN
    RAISERROR('Ph√≤ng ƒë√£ ƒë∆∞·ª£c ƒë·∫∑t trong th·ªùi gian n√†y', 16, 1);
    RETURN;
END</code></pre>
      </div>
</body>

</html>