<!DOCTYPE html>
<html lang="vi">

<head>
      <meta charset="UTF-8">
      <style>
            body {
                  font-family: 'Inter', -apple-system, sans-serif;
                  line-height: 1.7;
                  color: #1e293b;
                  background: #fff;
                  margin: 0;
                  padding: 0;
            }

            h1 {
                  font-size: 1.875rem;
                  font-weight: 700;
                  color: #1e40af;
                  margin: 0 0 1.5rem 0;
                  padding-bottom: 0.75rem;
                  border-bottom: 2px solid #3b82f6;
            }

            h2 {
                  font-size: 1.5rem;
                  font-weight: 600;
                  color: #0f172a;
                  margin: 2rem 0 1rem 0;
            }

            h3 {
                  font-size: 1.125rem;
                  font-weight: 600;
                  color: #334155;
                  margin: 1.5rem 0 0.75rem 0;
            }

            p {
                  margin: 0.75rem 0;
                  color: #475569;
            }

            ul {
                  margin: 0.75rem 0;
                  padding-left: 1.5rem;
            }

            li {
                  margin: 0.375rem 0;
                  color: #475569;
            }

            strong {
                  color: #0f172a;
                  font-weight: 600;
            }

            table {
                  width: 100%;
                  border-collapse: collapse;
                  margin: 1.25rem 0;
                  font-size: 0.9375rem;
                  background: #fff;
                  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                  border-radius: 0.5rem;
                  overflow: hidden;
            }

            th {
                  background-color: #93c5fd;
                  padding: 0.875rem 1rem;
                  text-align: left;
                  font-weight: 600;
                  color: #1e293b;
                  border-bottom: 2px solid #60a5fa;
            }

            td {
                  padding: 0.75rem 1rem;
                  color: #334155;
                  border-bottom: 1px solid #e2e8f0;
            }

            tbody tr:hover {
                  background-color: #f8fafc;
            }

            code {
                  font-family: 'Fira Code', monospace;
                  font-size: 0.875rem;
                  background-color: #f1f5f9;
                  color: #db2777;
                  padding: 0.125rem 0.375rem;
                  border-radius: 0.25rem;
            }

            .badge {
                  display: inline-flex;
                  align-items: center;
                  padding: 0.25rem 0.625rem;
                  border-radius: 0.375rem;
                  font-size: 0.8125rem;
                  font-weight: 500;
            }

            .badge-required {
                  background-color: #fee2e2;
                  color: #991b1b;
            }

            .badge-optional {
                  background-color: #dbeafe;
                  color: #1e40af;
            }

            pre {
                  background-color: #1e293b;
                  color: #e2e8f0;
                  padding: 1.25rem;
                  border-radius: 0.5rem;
                  overflow-x: auto;
                  margin: 1.25rem 0;
            }

            pre code {
                  background: none;
                  color: inherit;
                  padding: 0;
            }

            .flow-step {
                  background-color: #f8fafc;
                  border-left: 3px solid #3b82f6;
                  padding: 0.875rem 1rem;
                  margin: 0.5rem 0;
                  border-radius: 0.25rem;
                  color: #334155;
            }

            hr {
                  border: none;
                  border-top: 1px solid #e2e8f0;
                  margin: 2rem 0;
            }
      </style>
</head>

<body>
      <h1>‚≠ê STORED PROCEDURE ‚Äì ƒê√°nh Gi√° Ph√≤ng</h1>

      <h2>SP_DANHGIA ‚Äì T·∫°o ƒë√°nh gi√° ph√≤ng sau khi ho√†n th√†nh ƒë·∫∑t ph√≤ng</h2>

      <div class="section">
            <h3>üìå M·ª•c ƒë√≠ch</h3>
            <p>Cho ph√©p kh√°ch h√†ng <strong>ƒë√°nh gi√° ph√≤ng</strong> sau khi ƒë√£ ho√†n th√†nh ƒë·∫∑t ph√≤ng:</p>
            <ul>
                  <li>ƒê·∫£m b·∫£o ch·ªâ ƒë√°nh gi√° khi ƒë√£ ·ªü xong</li>
                  <li>M·ªói ƒë·∫∑t ph√≤ng ch·ªâ ƒë∆∞·ª£c ƒë√°nh gi√° <strong>1 l·∫ßn</strong></li>
                  <li>L∆∞u ƒë√°nh gi√° ·ªü tr·∫°ng th√°i ch·ªù duy·ªát (<code>CHO_XU_LY</code>)</li>
                  <li>H·ªó tr·ª£ qu·∫£n tr·ªã vi√™n ki·ªÉm duy·ªát n·ªôi dung</li>
            </ul>
      </div>

      <hr>

      <div class="section">
            <h3>üì• Tham s·ªë v√†o</h3>
            <table>
                  <thead>
                        <tr>
                              <th>T√™n tham s·ªë</th>
                              <th>Ki·ªÉu d·ªØ li·ªáu</th>
                              <th>B·∫Øt bu·ªôc</th>
                              <th>M√¥ t·∫£</th>
                        </tr>
                  </thead>
                  <tbody>
                        <tr>
                              <td><code>@UserId</code></td>
                              <td>INT</td>
                              <td><span class="badge badge-required">‚úî B·∫Øt bu·ªôc</span></td>
                              <td>ID ng∆∞·ªùi ƒë√°nh gi√°</td>
                        </tr>
                        <tr>
                              <td><code>@DatPhongId</code></td>
                              <td>INT</td>
                              <td><span class="badge badge-required">‚úî B·∫Øt bu·ªôc</span></td>
                              <td>ID ƒë·∫∑t ph√≤ng</td>
                        </tr>
                        <tr>
                              <td><code>@SoPhong</code></td>
                              <td>NVARCHAR(20)</td>
                              <td><span class="badge badge-required">‚úî B·∫Øt bu·ªôc</span></td>
                              <td>S·ªë ph√≤ng ƒë∆∞·ª£c ƒë√°nh gi√°</td>
                        </tr>
                        <tr>
                              <td><code>@SoSao</code></td>
                              <td>INT</td>
                              <td><span class="badge badge-required">‚úî B·∫Øt bu·ªôc</span></td>
                              <td>S·ªë sao ƒë√°nh gi√° (1 ‚Üí 5)</td>
                        </tr>
                        <tr>
                              <td><code>@BinhLuan</code></td>
                              <td>NVARCHAR(1000)</td>
                              <td><span class="badge badge-optional">‚úñ T√πy ch·ªçn</span></td>
                              <td>N·ªôi dung ƒë√°nh gi√°</td>
                        </tr>
                  </tbody>
            </table>
      </div>

      <hr>

      <div class="section">
            <h3>üìã ƒêi·ªÅu ki·ªán nghi·ªáp v·ª•</h3>
            <ul>
                  <li>Booking ph·∫£i thu·ªôc v·ªÅ user</li>
                  <li>Booking ph·∫£i c√≥ tr·∫°ng th√°i <code>HOAN_THANH</code></li>
                  <li>M·ªói <code>DATPHONG</code> ch·ªâ ƒë∆∞·ª£c ƒë√°nh gi√° m·ªôt l·∫ßn</li>
                  <li>S·ªë sao ph·∫£i t·ª´ <strong>1 ƒë·∫øn 5</strong></li>
                  <li>ƒê√°nh gi√° m·∫∑c ƒë·ªãnh ·ªü tr·∫°ng th√°i <code>CHO_XU_LY</code></li>
            </ul>
      </div>

      <hr>

      <div class="section">
            <h3>üîÑ Lu·ªìng x·ª≠ l√Ω</h3>
            <div class="flow-step">1. Ki·ªÉm tra booking t·ªìn t·∫°i, ƒë√∫ng user v√† ƒë√£ ho√†n th√†nh (<code>HOAN_THANH</code>)</div>
            <div class="flow-step">2. L·∫•y <code>PhongId</code> t·ª´ <code>SoPhong</code></div>
            <div class="flow-step">3. Ki·ªÉm tra ph√≤ng c√≥ thu·ªôc booking kh√¥ng</div>
            <div class="flow-step">4. Ki·ªÉm tra booking ƒë√£ ƒë∆∞·ª£c ƒë√°nh gi√° ch∆∞a</div>
            <div class="flow-step">5. Insert b·∫£n ghi v√†o <code>REVIEWS</code></div>
            <div class="flow-step">6. ƒê·∫∑t tr·∫°ng th√°i ƒë√°nh gi√° l√† <code>CHO_XU_LY</code></div>
      </div>

      <hr>

      <div class="section">
            <h3>‚úÖ V√≠ d·ª• g·ªçi</h3>
            <pre><code>EXEC SP_DANHGIA
    @UserId = 1,
    @DatPhongId = 1,
    @SoPhong = '103',
    @SoSao = 5,
    @BinhLuan = N'Ph√≤ng s·∫°ch s·∫Ω, nh√¢n vi√™n th√¢n thi·ªán, r·∫•t h√†i l√≤ng!';</code></pre>
      </div>
</body>

</html>
